<h2 mat-dialog-title>
  {{ isEditMode ? 'Edit Product' : 'Add New Product' }}
</h2>

<div class="dialog-content">

   <app-global-loader [loading]="loading" />
  <form [formGroup]="productForm" class="form-container">

    <!-- ðŸ”¹ Category Dropdown -->
    <mat-form-field appearance="outline">
      <mat-label>Select Category</mat-label>
      <mat-select formControlName="categoryId">
        <mat-option *ngFor="let cat of categories" [value]="cat.id">
          <div class="category-option">
            <img
              *ngIf="cat.coverImage"
              [src]="cat.coverImage"
              alt="{{ cat.name }}"
              class="option-image"
            />
            <span>{{ cat.name }}</span>
          </div>
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- ðŸ”¹ Product Name -->
    <mat-form-field appearance="outline">
      <mat-label>Product Name</mat-label>
      <input matInput placeholder="Enter product name" formControlName="name" />
    </mat-form-field>

    <!-- ðŸ”¹ Description -->
    <mat-form-field appearance="outline">
      <mat-label>Description</mat-label>
      <textarea
        matInput
        placeholder="Enter product description"
        rows="3"
        formControlName="description"
      ></textarea>
    </mat-form-field>

    <!-- ðŸ”¹ Price -->
    <mat-form-field appearance="outline">
      <mat-label>Price (â‚¹)</mat-label>
      <input matInput type="number" placeholder="Enter price" formControlName="price" />
    </mat-form-field>

    <!-- ðŸ”¹ Image Upload -->
     <!-- ðŸ”¹ Multiple Image Upload -->
<div class="upload">
  <label class="upload-label">
    <mat-icon>upload</mat-icon>
    <span>{{ selectedFiles.length ? selectedFiles.length + ' Images Selected' : 'Choose Images' }}</span>
    <input type="file" accept="image/*" multiple hidden (change)="onFilesSelected($event)" />
  </label>

  <!-- ðŸ”¹ Image Preview Grid -->
  <div class="preview-grid" *ngIf="imagePreviews.length > 0">
    <div class="preview-item" *ngFor="let img of imagePreviews; let i = index">
      <img [src]="img" alt="Preview {{ i + 1 }}" />
      <button mat-icon-button color="warn" class="remove-btn" (click)="removeImage(i)">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>
</div>

  </form>
</div>

<!-- ðŸ”¹ Footer Buttons -->
<div class="dialog-actions">
  <button mat-stroked-button (click)="cancel()">Cancel</button>

  <!-- ðŸ”¹ Show Delete only in Edit Mode -->
  <button
    *ngIf="isEditMode"
    mat-flat-button
    color="warn"
    (click)="deleteProduct()"
    [disabled]="loading"
  >
    Delete Product
  </button>


  <button
    mat-flat-button
    color="primary"
    (click)="saveProduct()"
    [disabled]="productForm.invalid || loading"
  >
    {{ isEditMode ? 'Update Product' : 'Save Product' }}
  </button>
</div>
