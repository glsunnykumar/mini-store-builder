<h2 mat-dialog-title>
  {{ isEditMode ? 'Edit Product' : 'Add New Product' }}
</h2>

<div class="dialog-content">

  <app-global-loader [loading]="loading" />
  <form [formGroup]="productForm" class="form-container">

    <!-- üîπ Category Dropdown -->
    <mat-form-field appearance="outline">
      <mat-label>Select Category</mat-label>
      <mat-select formControlName="categoryId">
        <mat-option *ngFor="let cat of categories" [value]="cat.id">
          <div class="category-option">
            <img *ngIf="cat.coverImage" [src]="cat.coverImage" alt="{{ cat.name }}" class="option-image" />
            <span>{{ cat.name }}</span>
          </div>
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- üîπ Product Name -->
    <mat-form-field appearance="outline">
      <mat-label>Product Name</mat-label>
      <input matInput placeholder="Enter product name" formControlName="name" />
    </mat-form-field>

    <!-- üîπ Description -->
    <mat-form-field appearance="outline">
      <mat-label>Description</mat-label>
      <textarea matInput placeholder="Enter product description" rows="3" formControlName="description"></textarea>
    </mat-form-field>

    <!-- üîπ Price -->
    <mat-form-field appearance="outline">
      <mat-label>Price (‚Çπ)</mat-label>
      <input matInput type="number" placeholder="Enter price" formControlName="price" />
    </mat-form-field>

    <!-- üîπ Multiple Image Upload Section -->
    <div class="upload-section">
      <h3 class="upload-title">Product Images</h3>
      <p class="upload-hint">
        You can upload <strong>multiple images</strong>.
        Click <strong>‚≠ê Set as Cover</strong> to select the main image.
        Use <strong>üóëÔ∏è Delete</strong> to remove an image.
      </p>

      <label class="upload-label">
        <mat-icon>cloud_upload</mat-icon>
        <span>{{ selectedFiles.length ? selectedFiles.length + ' Images Selected' : 'Upload Product Images' }}</span>
        <input type="file" accept="image/*" multiple hidden (change)="onFilesSelected($event)" />
      </label>

      <!-- üîπ Image Preview Grid -->
      <div class="preview-grid" *ngIf="imagePreviews.length > 0">
        <div class="preview-item" *ngFor="let img of imagePreviews; let i = index"
          [class.cover]="i === coverImageIndex">
          <img [src]="img" alt="Preview {{ i + 1 }}" />

          <div class="image-controls">
            <button mat-icon-button color="primary" (click)="setAsCover(i)" matTooltip="Set as Cover">
              <mat-icon>star</mat-icon>
            </button>
            <button mat-icon-button color="warn" (click)="removeImage(i)" matTooltip="Delete">
              <mat-icon>delete</mat-icon>
            </button>
          </div>

          <div class="cover-badge" *ngIf="i === coverImageIndex">Cover Image</div>
        </div>
      </div>
    </div>



  </form>
</div>

<!-- üîπ Footer Buttons -->
<div class="dialog-actions">
  <button mat-stroked-button (click)="cancel()">Cancel</button>

  <!-- üîπ Show Delete only in Edit Mode -->
  <button *ngIf="isEditMode" mat-flat-button color="warn" (click)="deleteProduct()" [disabled]="loading">
    Delete Product
  </button>


  <button mat-flat-button color="primary" (click)="saveProduct()" [disabled]="productForm.invalid || loading">
    {{ isEditMode ? 'Update Product' : 'Save Product' }}
  </button>
</div>