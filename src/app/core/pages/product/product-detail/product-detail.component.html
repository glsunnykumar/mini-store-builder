<!-- ===================== PRODUCT HERO SECTION ===================== -->
<section class="product-hero" *ngIf="product; else loadingTemplate">
  <!-- ðŸ–¼ï¸ Product Image -->
  <!-- ðŸ–¼ï¸ Image Carousel -->
<div class="image-area" *ngIf="product.images?.length">
  <div class="carousel">

    <!-- Left arrow -->
    <button class="nav left" (click)="prevImage()">
      <mat-icon>chevron_left</mat-icon>
    </button>

    <!-- Main image -->
    <div class="carousel-main">
      <img
        [src]="product.images[selectedImageIndex]"
        [alt]="product.name"
      />
    </div>

    <!-- Right arrow -->
    <button class="nav right" (click)="nextImage()">
      <mat-icon>chevron_right</mat-icon>
    </button>

    <!-- Thumbnails -->
    <div class="thumbnails">
      <img
        *ngFor="let img of product.images; let i = index"
        [src]="img"
        (click)="selectImage(i)"
        [class.active]="i === selectedImageIndex"
      />
    </div>

  </div>
</div>


  <!-- ðŸ§¾ Product Details -->
  <div class="details-area">
    <h1 class="product-name">{{ product.name }}</h1>
    <p class="product-category">Category ID: {{ product.categoryId }}</p>
    <p class="price">â‚¹{{ product.price }}</p>
    <p class="description">{{ product.description }}</p>

    <div class="actions">
      <button mat-flat-button color="primary" (click)="addToCart(product)">
        <mat-icon>shopping_cart</mat-icon> Add to Cart
      </button>
      <button mat-stroked-button color="warn" routerLink="/store">
        <mat-icon>close</mat-icon> Cancel
      </button>
    </div>

    <!-- â­ Ratings & Reviews -->
    <div class="review-section">
  <h3 class="review-title">Ratings & Reviews</h3>

  <div *ngIf="reviews.length > 0; else noReviews">
    <div class="rating-summary">
      <div class="avg-rating">
        <span class="rating-number">{{ averageRating.toFixed(1) }}</span>
        <mat-icon class="star-icon">star</mat-icon>
        <span class="total-reviews">({{ reviews.length }} Reviews)</span>
      </div>
    </div>

    <div class="review-list">
      <div class="review-card" *ngFor="let review of reviews">
        <div class="review-header">
          <mat-icon class="avatar">person</mat-icon>
          <div class="reviewer">
            <strong>{{ review.userName }}</strong>
            <div class="stars">
              <mat-icon *ngFor="let s of stars" [class.filled]="s <= review.rating">star</mat-icon>
            </div>
          </div>
        </div>
        <p class="review-text">{{ review.comment }}</p>
      </div>
    </div>
  </div>

  <ng-template #noReviews>
    <p class="no-review-text">No reviews yet. Be the first to review!</p>
  </ng-template>

  <!-- Add Review -->
  <div *ngIf="user; else loginPrompt" class="add-review">
    <h4>Add Your Review</h4>
    <div class="rating-input">
      <mat-icon
        *ngFor="let s of stars"
        (click)="setRating(s)"
        [class.filled]="s <= newReview.rating"
        >star</mat-icon
      >
    </div>

    <textarea
      placeholder="Write your review..."
      [(ngModel)]="newReview.comment"
      rows="3"
    ></textarea>

    <div class="review-actions">
      <button mat-stroked-button color="primary" (click)="resetReview()">Cancel</button>
      <button
        mat-flat-button
        color="primary"
        [disabled]="!newReview.comment || newReview.rating === 0"
        (click)="submitReview()"
      >
        Submit
      </button>
    </div>
  </div>

  <ng-template #loginPrompt>
    <div class="login-prompt">
      <p>
        You need to <a routerLink="/login">sign in</a> to leave a review.
      </p>
    </div>
  </ng-template>
</div>

  </div>
</section>

<!-- ===================== SIMILAR PRODUCTS CAROUSEL ===================== -->
<section
  class="similar-products-section"
  *ngIf="similarProducts.length > 0"
>
  <div class="header-with-arrows">
    <h2>Similar Products</h2>
    <div class="arrows">
      <button mat-icon-button (click)="scrollLeft()">
        <mat-icon>chevron_left</mat-icon>
      </button>
      <button mat-icon-button (click)="scrollRight()">
        <mat-icon>chevron_right</mat-icon>
      </button>
    </div>
  </div>

  <!-- ðŸ§­ Auto-scroll container -->
  <div
    class="scroll-container"
    #scrollContainer
    (mouseenter)="pauseAutoScroll()"
    (mouseleave)="resumeAutoScroll()"
  >
    <mat-card
      *ngFor="let p of similarProducts"
      class="product-card"
      (click)="openProduct(p)"
    >
      <img [src]="p.imageUrl" alt="{{ p.name }}" />
      <div class="info">
        <h4>{{ p.name }}</h4>
        <p>â‚¹{{ p.price }}</p>
      </div>
    </mat-card>
  </div>
</section>

<!-- ===================== LOADER ===================== -->
<ng-template #loadingTemplate>
  <div class="loading">
    <mat-spinner diameter="40"></mat-spinner>
    <p>Loading product details...</p>
  </div>
</ng-template>
